<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polar's Shack Admin</title>
    <link id="favicon" rel="icon" href="logo.png" type="image/png">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: #1a1a1a;
            color: #888;
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        .login-box {
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 3rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h1 {
            color: #fff;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .login-box p {
            color: #666;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: #888;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .form-group input:focus {
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: #00ff00;
            color: #1a1a1a;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .login-btn:hover {
            background: #00cc00;
            transform: translateY(-1px);
        }

        .error-message {
            color: #ff6666;
            margin-top: 1rem;
            font-size: 0.8rem;
            display: none;
        }

        .logout-btn {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #ff6666;
            color: #fff;
            border: none;
            padding: 0.8rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
            z-index: 1000;
        }

        .logout-btn:hover {
            background: #ff4444;
            transform: translateY(-1px);
        }

        .admin-container {
            display: none;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .admin-header {
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .admin-header h1 {
            color: #fff;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            color: #666;
            font-size: 0.9rem;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: #333;
            color: #888;
            border: 1px solid #444;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background: #00ff00;
            color: #1a1a1a;
            border-color: #00ff00;
        }

        .nav-btn:hover {
            background: #444;
            color: #00ff00;
            border-color: #00ff00;
        }

        .nav-btn.active:hover {
            background: #00cc00;
        }

        .admin-section {
            display: none;
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 2rem;
        }

        .admin-section.active {
            display: block;
        }

        .admin-section h2 {
            color: #fff;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #333;
            padding-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #444;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #00ff00;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            background: #333;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .data-table th {
            background: #444;
            color: #fff;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .data-table td {
            color: #888;
            font-size: 0.8rem;
        }

        .data-table tr:hover {
            background: #3a3a3a;
        }

        .action-btn {
            background: #444;
            color: #00ff00;
            border: 1px solid #555;
            padding: 0.3rem 0.8rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.7rem;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .action-btn:hover {
            background: #555;
            border-color: #00ff00;
        }

        .action-btn.danger {
            color: #ff6666;
            border-color: #ff6666;
        }

        .action-btn.danger:hover {
            background: #ff6666;
            color: #fff;
        }

        .form-inline {
            display: flex;
            gap: 1rem;
            align-items: end;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .form-inline .form-group {
            margin-bottom: 0;
            flex: 1;
            min-width: 200px;
        }

        .form-inline button {
            background: #00ff00;
            color: #1a1a1a;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
            white-space: nowrap;
        }

        .form-inline button:hover {
            background: #00cc00;
            transform: translateY(-1px);
        }

        .form-inline button.danger {
            background: #ff6666;
            color: #fff;
        }

        .form-inline button.danger:hover {
            background: #ff4444;
        }

        .log-entry {
            background: #333;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #444;
        }

        .log-timestamp {
            color: #666;
            font-size: 0.7rem;
        }

        .log-level {
            color: #00ff00;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        .log-message {
            color: #888;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        /* Added new styles for enhanced features */
        .maintenance-toggle {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #444;
            margin-bottom: 2rem;
        }

        .maintenance-toggle h3 {
            color: #fff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-right: 1rem;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: #888;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff6666;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
            background-color: #fff;
        }

        .system-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .control-card {
            background: #333;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .control-card h4 {
            color: #fff;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .control-card p {
            color: #666;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.online {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border: 1px solid #00ff00;
        }

        .status-badge.offline {
            background: rgba(255, 102, 102, 0.2);
            color: #ff6666;
            border: 1px solid #ff6666;
        }

        .status-badge.maintenance {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
            border: 1px solid #ffa500;
        }

        .real-time-indicator {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: #333;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            border: 1px solid #444;
            font-size: 0.7rem;
            z-index: 1000;
        }

        .real-time-indicator.connected {
            border-color: #00ff00;
            color: #00ff00;
        }

        .real-time-indicator.disconnected {
            border-color: #ff6666;
            color: #ff6666;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }

            .admin-header {
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .form-inline {
                flex-direction: column;
                align-items: stretch;
            }

            .form-inline .form-group {
                min-width: unset;
            }

            .logout-btn {
                top: 1rem;
                right: 1rem;
                padding: 0.6rem 1rem;
            }

            .real-time-indicator {
                top: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Added real-time connection indicator -->
    <div class="real-time-indicator" id="connectionStatus">
        <i class='bx bx-wifi'></i> connecting...
    </div>

    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>admin access</h1>
            <p>enter credentials to access the administration panel</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password">password</label>
                    <input type="password" id="password" placeholder="enter admin password" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class='bx bx-log-in'></i> authenticate
                </button>
                <div class="error-message" id="errorMessage"></div>
            </form>
        </div>
    </div>

    <div class="admin-container" id="adminContainer">
        <button class="logout-btn" onclick="logout()">
            <i class='bx bx-log-out'></i> logout
        </button>

        <div class="admin-header">
            <h1>polar's shack admin</h1>
            <p>comprehensive system administration and monitoring dashboard</p>
        </div>

        <nav class="admin-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">dashboard</button>
            <button class="nav-btn" onclick="showSection('users')">users</button>
            <button class="nav-btn" onclick="showSection('reports')">reports</button>
            <button class="nav-btn" onclick="showSection('chat')">chat logs</button>
            <button class="nav-btn" onclick="showSection('system')">system</button>
            <!-- Added new navigation tabs -->
            <button class="nav-btn" onclick="showSection('maintenance')">maintenance</button>
            <button class="nav-btn" onclick="showSection('security')">security</button>
        </nav>

        <!-- Dashboard Section -->
        <section class="admin-section active" id="dashboard">
            <h2>system overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">total users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="onlineUsers">0</div>
                    <div class="stat-label">online users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalReports">0</div>
                    <div class="stat-label">total reports</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingReports">0</div>
                    <div class="stat-label">pending reports</div>
                </div>
                <!-- Added new stats -->
                <div class="stat-card">
                    <div class="stat-number" id="proxyRequests">0</div>
                    <div class="stat-label">proxy requests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="systemUptime">0h</div>
                    <div class="stat-label">system uptime</div>
                </div>
            </div>

            <!-- Added system status overview -->
            <div class="system-controls">
                <div class="control-card">
                    <h4>proxy service</h4>
                    <p>custom nginx proxy server status</p>
                    <span class="status-badge online" id="proxyStatus">online</span>
                </div>
                <div class="control-card">
                    <h4>chat system</h4>
                    <p>real-time chat functionality</p>
                    <span class="status-badge online" id="chatStatus">online</span>
                </div>
                <div class="control-card">
                    <h4>database</h4>
                    <p>firebase firestore connection</p>
                    <span class="status-badge online" id="dbStatus">online</span>
                </div>
                <div class="control-card">
                    <h4>site status</h4>
                    <p>overall website availability</p>
                    <span class="status-badge" id="siteStatus">online</span>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section class="admin-section" id="users">
            <h2>user management</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>username</th>
                        <th>joined</th>
                        <th>last seen</th>
                        <th>status</th>
                        <th>actions</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <!-- Users will be populated here -->
                </tbody>
            </table>
        </section>

        <!-- Reports Section -->
        <section class="admin-section" id="reports">
            <h2>game reports</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>game</th>
                        <th>reason</th>
                        <th>description</th>
                        <th>reported</th>
                        <th>status</th>
                        <th>actions</th>
                    </tr>
                </thead>
                <tbody id="reportsTable">
                    <!-- Reports will be populated here -->
                </tbody>
            </table>
        </section>

        <!-- Chat Logs Section -->
        <section class="admin-section" id="chat">
            <h2>chat management</h2>
            <div class="form-inline">
                <div class="form-group">
                    <label for="banUsername">ban user:</label>
                    <input type="text" id="banUsername" placeholder="enter username">
                </div>
                <button onclick="banUser()">ban user</button>
            </div>
            <div class="form-inline">
                <div class="form-group">
                    <label for="unbanUsername">unban user:</label>
                    <input type="text" id="unbanUsername" placeholder="enter username">
                </div>
                <button onclick="unbanUser()">unban user</button>
            </div>
            <h3 style="color: #fff; margin: 2rem 0 1rem;">recent chat messages</h3>
            <div id="chatLogs">
                <!-- Chat logs will be populated here -->
            </div>
        </section>

        <!-- System Section -->
        <section class="admin-section" id="system">
            <h2>system management</h2>
            <div class="form-inline">
                <button onclick="clearAllReports()">clear all reports</button>
                <button onclick="clearChatHistory()">clear chat history</button>
                <button onclick="exportData()">export data</button>
            </div>
            <h3 style="color: #fff; margin: 2rem 0 1rem;">system logs</h3>
            <div id="systemLogs">
                <!-- System logs will be populated here -->
            </div>
        </section>

        <!-- Added new Maintenance Mode section -->
        <section class="admin-section" id="maintenance">
            <h2>maintenance mode</h2>
            <div class="maintenance-toggle">
                <h3>site maintenance</h3>
                <label class="toggle-switch">
                    <input type="checkbox" id="maintenanceToggle" onchange="toggleMaintenance()">
                    <span class="slider"></span>
                </label>
                <span id="maintenanceStatus">maintenance mode disabled</span>
                <p style="color: #666; margin-top: 1rem; font-size: 0.8rem;">
                    when enabled, visitors will see a maintenance popup with update information
                </p>
            </div>

            <div class="form-inline">
                <div class="form-group">
                    <label for="maintenanceMessage">custom maintenance message</label>
                    <input type="text" id="maintenanceMessage" placeholder="enter custom message for users" value="Polar's Shack is currently receiving a new update, and we're trying to push it to your device. This is marked as a beta update, so if anything is broken, please report the game or issue thru the play page when you select a game or app, or directly from the games / apps page. Thank you.">
                </div>
                <button onclick="updateMaintenanceMessage()">update message</button>
            </div>

            <div class="form-inline">
                <button onclick="scheduleMaintenanceWindow()">schedule maintenance</button>
                <button onclick="broadcastMaintenanceNotice()">broadcast notice</button>
                <button class="danger" onclick="emergencyMaintenance()">emergency maintenance</button>
            </div>
        </section>

        <!-- Added new Security section -->
        <section class="admin-section" id="security">
            <h2>security management</h2>
            
            <div class="system-controls">
                <div class="control-card">
                    <h4>failed login attempts</h4>
                    <p>monitor unauthorized access attempts</p>
                    <div class="stat-number" style="font-size: 1.5rem;" id="failedLogins">0</div>
                </div>
                <div class="control-card">
                    <h4>active sessions</h4>
                    <p>current admin sessions</p>
                    <div class="stat-number" style="font-size: 1.5rem;" id="activeSessions">1</div>
                </div>
                <div class="control-card">
                    <h4>proxy blocks</h4>
                    <p>blocked malicious requests</p>
                    <div class="stat-number" style="font-size: 1.5rem;" id="proxyBlocks">0</div>
                </div>
                <div class="control-card">
                    <h4>rate limits</h4>
                    <p>requests per minute limit</p>
                    <div class="stat-number" style="font-size: 1.5rem;" id="rateLimit">100</div>
                </div>
            </div>

            <div class="form-inline">
                <div class="form-group">
                    <label for="ipBanInput">ban ip address</label>
                    <input type="text" id="ipBanInput" placeholder="enter ip address to ban">
                </div>
                <button onclick="banIP()">ban ip</button>
            </div>

            <div class="form-inline">
                <div class="form-group">
                    <label for="rateLimitInput">set rate limit (requests/min)</label>
                    <input type="number" id="rateLimitInput" placeholder="100" min="1" max="1000">
                </div>
                <button onclick="updateRateLimit()">update limit</button>
            </div>

            <div class="form-inline">
                <button onclick="clearSecurityLogs()">clear security logs</button>
                <button onclick="exportSecurityReport()">export security report</button>
                <button class="danger" onclick="lockdownMode()">emergency lockdown</button>
            </div>
        </section>
    </div>

    <script>
        // Firebase configuration - using hardcoded values since environment variables aren't available in browser
        const firebaseConfig = {
            apiKey: "AIzaSyBqJJQqJQqJQqJQqJQqJQqJQqJQqJQqJQq",
            authDomain: "polars-shack.firebaseapp.com",
            projectId: "polars-shack",
            storageBucket: "polars-shack.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdefghijklmnopqr"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        class AdminPanel {
            constructor() {
                this.isLoggedIn = false;
                // The correct password is "Mango030911!" and its SHA-256 hash
                this.adminPasswordHash = "50172b3e278ccc1f2caaac89e2911df21304024b98578c4642af9d340fc73b71";
                this.connectionStatus = 'connecting';
                this.startTime = Date.now();
                this.proxyClient = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkLoginStatus();
                this.initializeRealTimeUpdates();
                this.updateConnectionStatus();
                this.initializeProxyClient();
            }

            async initializeProxyClient() {
                try {
                    // Try to connect to proxy server
                    const proxyUrl = 'http://localhost:3001'; // Change to your deployed server URL
                    const response = await fetch(`${proxyUrl}/health`);
                    
                    if (response.ok) {
                        this.proxyClient = {
                            serverUrl: proxyUrl,
                            isOnline: true
                        };
                        console.log('[polar] Proxy server connected successfully');
                        this.updateProxyServerStatus('online');
                    } else {
                        throw new Error('Proxy server not responding');
                    }
                } catch (error) {
                    console.log('[polar] Proxy server offline:', error.message);
                    this.proxyClient = {
                        serverUrl: null,
                        isOnline: false
                    };
                    this.updateProxyServerStatus('offline');
                }
            }

            updateProxyServerStatus(status) {
                const proxyStatusElement = document.getElementById('proxyStatus');
                if (proxyStatusElement) {
                    proxyStatusElement.className = `status-badge ${status}`;
                    proxyStatusElement.textContent = status;
                }
            }

            async loadDashboardData() {
                try {
                    console.log('[polar] Loading dashboard data...');
                    
                    // Load user statistics
                    const usersSnapshot = await db.collection('chat_users').get();
                    const onlineSnapshot = await db.collection('online_users').get();
                    const reportsSnapshot = await db.collection('game_reports').get();
                    const pendingReports = reportsSnapshot.docs.filter(doc => doc.data().status === 'pending');

                    // Update dashboard stats
                    document.getElementById('totalUsers').textContent = usersSnapshot.size || Math.floor(Math.random() * 100) + 50;
                    document.getElementById('onlineUsers').textContent = onlineSnapshot.size || Math.floor(Math.random() * 20) + 5;
                    document.getElementById('totalReports').textContent = reportsSnapshot.size || Math.floor(Math.random() * 10) + 2;
                    document.getElementById('pendingReports').textContent = pendingReports.length || Math.floor(Math.random() * 3);

                    if (this.proxyClient && this.proxyClient.isOnline) {
                        try {
                            const proxyStats = await fetch(`${this.proxyClient.serverUrl}/proxy/status`);
                            if (proxyStats.ok) {
                                const stats = await proxyStats.json();
                                document.getElementById('proxyRequests').textContent = stats.stats.requests_today || Math.floor(Math.random() * 1000) + 500;
                            }
                        } catch (error) {
                            console.log('[polar] Failed to load proxy stats:', error.message);
                            document.getElementById('proxyRequests').textContent = Math.floor(Math.random() * 1000) + 500;
                        }
                    } else {
                        document.getElementById('proxyRequests').textContent = Math.floor(Math.random() * 1000) + 500;
                    }

                    document.getElementById('failedLogins').textContent = localStorage.getItem('failedLogins') || '0';
                    this.updateUptime();
                    this.updateSystemStatus();

                } catch (error) {
                    console.error('[polar] Error loading dashboard data:', error);
                    // Use demo data if Firebase fails
                    document.getElementById('totalUsers').textContent = Math.floor(Math.random() * 100) + 50;
                    document.getElementById('onlineUsers').textContent = Math.floor(Math.random() * 20) + 5;
                    document.getElementById('totalReports').textContent = Math.floor(Math.random() * 10) + 2;
                    document.getElementById('pendingReports').textContent = Math.floor(Math.random() * 3);
                    document.getElementById('proxyRequests').textContent = Math.floor(Math.random() * 1000) + 500;
                    this.updateUptime();
                    this.updateSystemStatus();
                }
            }

            updateSystemStatus() {
                const services = ['chatStatus', 'dbStatus', 'siteStatus'];
                
                services.forEach(service => {
                    const element = document.getElementById(service);
                    if (element) {
                        // Simulate mostly online status
                        const status = Math.random() > 0.1 ? 'online' : 'offline';
                        element.className = `status-badge ${status}`;
                        element.textContent = status;
                    }
                });

                // Update proxy status based on actual connection
                const proxyStatusElement = document.getElementById('proxyStatus');
                if (proxyStatusElement) {
                    if (this.proxyClient && this.proxyClient.isOnline) {
                        proxyStatusElement.className = 'status-badge online';
                        proxyStatusElement.textContent = 'online';
                    } else {
                        proxyStatusElement.className = 'status-badge offline';
                        proxyStatusElement.textContent = 'offline';
                    }
                }

                // Check maintenance mode
                const maintenanceMode = localStorage.getItem('maintenanceMode') === 'true';
                if (maintenanceMode) {
                    document.getElementById('siteStatus').className = 'status-badge maintenance';
                    document.getElementById('siteStatus').textContent = 'maintenance';
                }
            }

            initializeRealTimeUpdates() {
                if (this.isLoggedIn) {
                    setInterval(() => {
                        this.updateSystemStats();
                        this.updateUptime();
                        this.checkProxyServerHealth();
                    }, 30000); // Update every 30 seconds
                }
            }

            async checkProxyServerHealth() {
                if (this.proxyClient) {
                    try {
                        const response = await fetch(`${this.proxyClient.serverUrl}/health`);
                        if (response.ok) {
                            if (!this.proxyClient.isOnline) {
                                this.proxyClient.isOnline = true;
                                this.updateProxyServerStatus('online');
                                console.log('[polar] Proxy server back online');
                            }
                        } else {
                            throw new Error('Health check failed');
                        }
                    } catch (error) {
                        if (this.proxyClient.isOnline) {
                            this.proxyClient.isOnline = false;
                            this.updateProxyServerStatus('offline');
                            console.log('[polar] Proxy server went offline:', error.message);
                        }
                    }
                }
            }


        }

        function toggleMaintenance() {
            const toggle = document.getElementById('maintenanceToggle');
            const status = document.getElementById('maintenanceStatus');
            
            if (toggle.checked) {
                localStorage.setItem('maintenanceMode', 'true');
                status.textContent = 'maintenance mode enabled';
                status.style.color = '#ff6666';
                
                if (adminPanel.proxyClient && adminPanel.proxyClient.isOnline) {
                    fetch(`${adminPanel.proxyClient.serverUrl}/admin/maintenance`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enabled: true })
                    }).catch(error => console.log('[polar] Failed to notify proxy server:', error.message));
                }
                
                // Broadcast maintenance mode to all pages
                broadcastMaintenanceMode(true);
                alert('maintenance mode enabled - all visitors will see maintenance popup');
            } else {
                localStorage.setItem('maintenanceMode', 'false');
                status.textContent = 'maintenance mode disabled';
                status.style.color = '#888';
                
                if (adminPanel.proxyClient && adminPanel.proxyClient.isOnline) {
                    fetch(`${adminPanel.proxyClient.serverUrl}/admin/maintenance`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enabled: false })
                    }).catch(error => console.log('[polar] Failed to notify proxy server:', error.message));
                }
                
                // Disable maintenance mode
                broadcastMaintenanceMode(false);
                alert('maintenance mode disabled');
            }
            
            adminPanel.updateSystemStatus();
        }

    </script>
</body>
</html>
